<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‚˜ë‘ ë‹®ì€ ë™ë¬¼ í…ŒìŠ¤íŠ¸</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link
    href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      --main: #5468ff;
      --accent: #ffc062;
      --bg: #f7f8fa;
      --white: #fff;
      --gray: #e1e3e6;
      --text: #2c3040;
      --radius: 16px;
      --max-animal-weight-ratio: 0.4;
    }
    * {
      box-sizing: border-box;
    }
    body {
      min-height: 100vh;
      margin: 0;
      font-family: "Pretendard", sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .container {
      max-width: 420px;
      margin: 40px auto;
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: 0 6px 32px rgba(80, 90, 140, 0.09);
      padding: 32px;
      animation: fadeIn 1s;
      display: flex;
      flex-direction: column;
      min-height: 600px;
    }
    header {
      text-align: center;
    }
    header h1 {
      font-size: 2.1rem;
      font-weight: 700;
      letter-spacing: -1px;
      margin: 0 0 10px 0;
    }
    header p {
      color: var(--main);
      margin: 0 0 18px 0;
      letter-spacing: -0.5px;
      font-size: 1.05rem;
    }
    .progress {
      width: 90%;
      margin: 16px auto 32px auto;
      height: 6px;
      background: var(--gray);
      border-radius: 3px;
      overflow: hidden;
    }
    .progress-bar {
      background: linear-gradient(90deg, var(--main), var(--accent));
      height: 100%;
      width: 0;
      transition: width 0.4s cubic-bezier(0.5, 2, 0.5, 1);
    }
    .question-area {
      min-height: 140px;
      font-size: 1.15rem;
      margin-bottom: 28px;
      text-align: center;
      line-height: 1.6;
      font-weight: 600;
      letter-spacing: -0.2px;
      flex-grow: 1;
    }
    .choices {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 12px;
    }
    .choicebtn {
      border: none;
      outline: none;
      background: var(--gray);
      color: var(--text);
      font-size: 1.04rem;
      padding: 18px;
      border-radius: var(--radius);
      font-family: inherit;
      cursor: pointer;
      transition: background 0.18s, color 0.18s, transform 0.14s;
      font-weight: 500;
      user-select: none;
    }
    .choicebtn.selected,
    .choicebtn:active {
      background: var(--main);
      color: #fff;
      transform: scale(1.03);
    }
    .hide {
      display: none;
    }
    .result-area {
      text-align: center;
      animation: fadeInUp 0.7s;
    }
    .result-area .emoji {
      font-size: 3.5rem;
      margin-bottom: 8px;
      display: block;
    }
    .result-animal {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--main);
      margin-bottom: 8px;
      letter-spacing: -0.8px;
    }
    .result-desc {
      color: #666;
      font-weight: 400;
      margin-bottom: 22px;
      font-size: 1.09rem;
    }
    .keywords {
      font-size: 1.03rem;
      margin-bottom: 24px;
      color: var(--accent);
      letter-spacing: 0.01em;
    }
    .share-btn {
      background: var(--main);
      color: #fff;
      padding: 14px 0;
      width: 70%;
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      font-family: inherit;
      margin: 0 auto 12px auto;
      cursor: pointer;
      display: block;
      transition: background 0.17s;
      user-select: none;
    }
    .share-btn:hover {
      background: #3f54cc;
    }
    .restart-btn {
      background: var(--gray);
      color: var(--text);
      padding: 11px 0;
      width: 50%;
      border: none;
      border-radius: var(--radius);
      font-size: 0.96rem;
      font-family: inherit;
      margin: 0 auto;
      cursor: pointer;
      display: block;
      transition: background 0.2s;
      user-select: none;
    }
    .restart-btn:hover {
      background: #c6c7cd;
    }
    @media (max-width: 560px) {
      .container {
        padding: 15px;
        min-height: 600px;
      }
    }
    @keyframes fadeInUp {
      0% {
        opacity: 0;
        transform: translateY(24px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @keyframes fadeIn {
      0% {
        opacity: 0;
      }
      100% {
        opacity: 1;
      }
    }
  </style>
</head>
<body>
<div class="container" role="main" aria-label="ë‚˜ë‘ ë‹®ì€ ë™ë¬¼ í…ŒìŠ¤íŠ¸">
  <header>
    <h1>ë‚˜ë‘ ë‹®ì€ ë™ë¬¼ í…ŒìŠ¤íŠ¸</h1>
    <p>
      <b>20ë¬¸í•­ë§Œ ë‹µí•˜ë©´<br />ë‚´ ì„±í–¥ê³¼ ë‹®ì€ ë™ë¬¼ì´ ë‚˜ì™€ìš”!</b>
    </p>
  </header>
  <div class="progress" aria-label="ì§„í–‰ë¥ ">
    <div class="progress-bar"></div>
  </div>
  <div class="question-area" aria-live="polite"></div>
  <div class="choices"></div>
  <div class="result-area hide" aria-live="polite"></div>
</div>
<script>
  const dataPool = {
    questions: [
      {"text": "ìƒˆë¡œìš´ ì‚¬ëŒê³¼ ê¸ˆë°© ì¹œí•´ì§€ëŠ” í¸ì´ë‹¤.", "scores": {"ê°•ì•„ì§€": 5, "ì—¬ìš°": 3, "í­ê·„": 2}},
      {"text": "ì¦‰í¥ì ì¸ ì—¬í–‰ì´ë‚˜ ê³„íšì„ ì¢‹ì•„í•œë‹¤.", "scores": {"ì—¬ìš°": 5, "ì¹˜íƒ€": 4, "í† ë¼": 2}},
      {"text": "í˜ë“¤ ë•Œ ê°€ì¡±ì´ë‚˜ ì¹œêµ¬ì—ê²Œ ë°”ë¡œ í„¸ì–´ë†“ëŠ”ë‹¤.", "scores": {"ê°•ì•„ì§€": 5, "í­ê·„": 3, "íŒë‹¤": 2}},
      {"text": "í˜¼ì ìˆëŠ” ì‹œê°„ì´ ê¼­ í•„ìš”í•˜ë‹¤.", "scores": {"ê³ ì–‘ì´": 5, "ì‚¬ìŠ´": 4, "ë¶€ì—‰ì´": 3}},
      {"text": "ê³„íšì— ì–´ê¸‹ë‚˜ë©´ ë¶ˆì•ˆí•˜ë‹¤.", "scores": {"ë¶€ì—‰ì´": 5, "ê³°": 3, "ê³ ì–‘ì´": 2}},
      {"text": "ì‘ì€ ë³€í™”ë‚˜ ë‚Œìƒˆë„ ì˜ ì•Œì•„ì°¨ë¦°ë‹¤.", "scores": {"ê³ ì–‘ì´": 5, "í† ë¼": 3, "ì‚¬ìŠ´": 2}},
      {"text": "íƒ€ì¸ì˜ ê°ì •ì— ì‰½ê²Œ ê³µê°í•˜ëŠ” í¸ì´ë‹¤.", "scores": {"í† ë¼": 5, "íŒë‹¤": 4, "í­ê·„": 2}},
      {"text": "ì–´ë ¤ìš´ ìƒí™©ì„ ë§Œë‚˜ë©´ ìŠ¤ìŠ¤ë¡œ ë°©ë²•ì„ ì°¾ìœ¼ë ¤ í•œë‹¤.", "scores": {"ê³°": 5, "ë¶€ì—‰ì´": 4, "ì¹˜íƒ€": 3}},
      {"text": "ê°ì •ë³´ë‹¤ëŠ” ë…¼ë¦¬ë¡œ íŒë‹¨í•˜ëŠ” í¸ì´ë‹¤.", "scores": {"ë¶€ì—‰ì´": 5, "ê³°": 3, "ì—¬ìš°": 2}},
      {"text": "ì—¬ëŸ¿ì´ ëª¨ì´ëŠ” í™œë™ì´ ì¦ê²ë‹¤.", "scores": {"ê°•ì•„ì§€": 5, "í­ê·„": 4, "í† ë¼": 2}},
      {"text": "ì‹¤íŒ¨ë¥¼ í•´ë„ ê¸ˆë°© ë‹¤ì‹œ ë„ì „í•œë‹¤.", "scores": {"ì¹˜íƒ€": 5, "ê³°": 4, "ì‚¬ìŠ´": 2}},
      {"text": "ê³ ë¯¼ì´ ìˆì„ ë•Œ ë¨¸ë¦¿ì†ìœ¼ë¡œ ì—¬ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìƒìƒí•œë‹¤.", "scores": {"ë¶€ì—‰ì´": 5, "ê³ ì–‘ì´": 3, "ì—¬ìš°": 2}},
      {"text": "ì„¸ë¶€ì ì¸ ê²ƒë³´ë‹¨ ì „ì²´ì ì¸ íë¦„ì„ ì¤‘ì‹œí•œë‹¤.", "scores": {"ì—¬ìš°": 5, "ì¹˜íƒ€": 4, "ë¶€ì—‰ì´": 2}},
      {"text": "ì•„ëŠ” ê²ƒ, ëª¨ë¥´ëŠ” ê²Œ ëª…í™•í•œ í¸ì´ë‹¤.", "scores": {"ë¶€ì—‰ì´": 5, "ê³°": 3, "ê³ ì–‘ì´": 2}},
      {"text": "ë¶ˆí•„ìš”í•œ ëŒ€í™”ëŠ” í”¼í•œë‹¤.", "scores": {"ê³ ì–‘ì´": 5, "ë¶€ì—‰ì´": 3, "ì‚¬ìŠ´": 2}},
      {"text": "ì¼ì„ ë¯¸ë£¨ì§€ ì•Šê³  ë°”ë¡œ ì²˜ë¦¬í•˜ë ¤ê³  í•œë‹¤.", "scores": {"ê³°": 5, "ì¹˜íƒ€": 4, "í­ê·„": 2}},
      {"text": "ë‚¨ì„ ë„ì™€ì£¼ëŠ” ì¼ì´ ë§ë‹¤.", "scores": {"í† ë¼": 5, "í­ê·„": 4, "íŒë‹¤": 3}},
      {"text": "ê²½ìŸë³´ë‹¤ëŠ” í˜‘ë ¥ì„ ì¶”êµ¬í•œë‹¤.", "scores": {"í­ê·„": 5, "í† ë¼": 4, "íŒë‹¤": 2}},
      {"text": "ìœ ë¨¸ëŸ¬ìŠ¤í•˜ë‹¤ëŠ” ì–˜ê¸°ë¥¼ ì¢…ì¢… ë“£ëŠ”ë‹¤.", "scores": {"í­ê·„": 5, "ì—¬ìš°": 4, "ì¹˜íƒ€": 2}},
      {"text": "ìƒˆë¡œìš´ ì‹œë„ë¥¼ ë‘ë ¤ì›Œí•˜ì§€ ì•ŠëŠ”ë‹¤.", "scores": {"ì¹˜íƒ€": 5, "ì—¬ìš°": 4, "ê°•ì•„ì§€": 2}},
      {"text": "ë‚˜ëŠ” ì¼ìƒì—ì„œ ì‘ì€ ì¼ì— í–‰ë³µì„ ëŠë‚€ë‹¤.", "scores": {"íŒë‹¤":5,"ì‚¬ìŠ´":3,"ê³ ì–‘ì´":2}},
      {"text": "ë¦¬ë”ì‹­ì„ ë°œíœ˜í•  ê¸°íšŒê°€ ìˆìœ¼ë©´ ì£¼ì €í•˜ì§€ ì•Šê³  ë‚˜ì„ ë‹¤.", "scores": {"ê³°":5,"ì¹˜íƒ€":4,"ë¶€ì—‰ì´":3}},
      {"text": "ì‚¬ëŒë“¤ì„ ì›ƒê¸°ëŠ” ê±¸ ì¢‹ì•„í•œë‹¤.", "scores": {"í­ê·„":5,"ì—¬ìš°":4,"ê°•ì•„ì§€":2}},
      {"text": "ìƒˆë¡œìš´ ì§€ì‹ì„ ë°°ìš°ëŠ” ë° ì¦ê±°ì›€ì„ ëŠë‚€ë‹¤.", "scores": {"ë¶€ì—‰ì´":5,"ê³ ì–‘ì´":3,"ì¹˜íƒ€":2}},
      {"text": "ë³€í™”í•˜ëŠ” ìƒí™©ì— ë¹ ë¥´ê²Œ ì ì‘í•˜ëŠ” í¸ì´ë‹¤.", "scores": {"ì—¬ìš°":5,"ì¹˜íƒ€":4,"í­ê·„":3}},
      {"text": "í˜¼ì ì—¬í–‰í•˜ëŠ” ê±¸ ì¢‹ì•„í•œë‹¤.", "scores": {"ê³ ì–‘ì´":5,"ì‚¬ìŠ´":4,"íŒë‹¤":3}},
      {"text": "ì–´ë ¤ìš´ ê°ì •ë„ ì˜ ìˆ¨ê¸°ê³  ì¹¨ì°©í•˜ê²Œ ë„˜ê¸´ë‹¤.", "scores": {"ê³°":5,"ë¶€ì—‰ì´":4,"í† ë¼":3}},
      {"text": "íŒ€ì˜ ë¶„ìœ„ê¸°ë¥¼ ë°ê²Œ ë§Œë“œëŠ” ì—­í• ì„ ìì£¼ ë§¡ëŠ”ë‹¤.", "scores": {"ê°•ì•„ì§€":5,"í­ê·„":4,"í† ë¼":3}},
      {"text": "ì‹¤ìˆ˜ë¥¼ í•´ë„ ìŠ¤ìŠ¤ë¡œë¥¼ ë¹¨ë¦¬ ìš©ì„œí•˜ëŠ” í¸ì´ë‹¤.", "scores": {"íŒë‹¤":5,"ì¹˜íƒ€":3,"ê°•ì•„ì§€":2}},
      {"text": "ìì‹ ë§Œì˜ ìŠ¤íƒ€ì¼ì´ ëšœë ·í•˜ë‹¤.", "scores": {"ê³ ì–‘ì´":5,"ì—¬ìš°":4,"ë¶€ì—‰ì´":2}},
      {"text": "ì¹œêµ¬ë‚˜ ë™ë£Œì˜ ê³ ë¯¼ì„ ì§„ì‹¬ìœ¼ë¡œ ë“¤ì–´ì¤€ë‹¤.", "scores": {"í† ë¼":5,"íŒë‹¤":4,"ê³ ì–‘ì´":2}},
      {"text": "ìƒˆë¡œìš´ ê¸€ì“°ê¸°ë‚˜ ê·¸ë¦¼ ë“± ì°½ì˜ì  ì‘ì—…ì„ ì¦ê¸´ë‹¤.", "scores": {"ì—¬ìš°":5,"ê³ ì–‘ì´":4,"ì¹˜íƒ€":3}},
      {"text": "ëª©í‘œë¥¼ ì„¸ìš°ë©´ ëê¹Œì§€ í¬ê¸°í•˜ì§€ ì•Šê³  ë…¸ë ¥í•œë‹¤.", "scores": {"ê³°":5,"ì‚¬ìŠ´":4,"ë¶€ì—‰ì´":3}},
      {"text": "ê°€ë”ì€ ì¦‰í¥ì ìœ¼ë¡œ í–‰ë™í•˜ëŠ” ê±¸ ì¢‹ì•„í•œë‹¤.", "scores": {"ì¹˜íƒ€":5,"ì—¬ìš°":4,"í­ê·„":2}},
      {"text": "ë‹¤ë¥¸ ì‚¬ëŒê³¼ì˜ ì¡°í™”ì™€ ê· í˜•ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•œë‹¤.", "scores": {"í­ê·„":5,"í† ë¼":4,"ì‚¬ìŠ´":3}}
    ],
    results: [
      {"animal": "ê³ ì–‘ì´", "keywords": ["ê´€ì°°ë ¥", "ë…ë¦½ì ", "ì„¬ì„¸í•¨"], "description": "ë‹¹ì‹ ì€ ê´€ì°°ë ¥ì´ ë›°ì–´ë‚˜ê³  í˜¼ìë§Œì˜ ì‹œê°„ì„ ì†Œì¤‘í•˜ê²Œ ì—¬ê¸°ëŠ” ì„¬ì„¸í•œ íƒ€ì…ì´ì—ìš”.", "emoji": "ğŸ±"},
      {"animal": "ê°•ì•„ì§€", "keywords": ["ì‚¬êµì ", "ì—ë„ˆì§€", "ì¶©ì„±ì‹¬"], "description": "ì‚¬êµì„±ê³¼ ì—ë„ˆì§€ê°€ ë„˜ì¹˜ë©°, ì¹œêµ¬ì™€ ìˆì„ ë•Œ ê°€ì¥ í–‰ë³µí•œ ì‚¬ëŒì…ë‹ˆë‹¤!", "emoji": "ğŸ¶"},
      {"animal": "ë¶€ì—‰ì´", "keywords": ["ë…¼ë¦¬", "ì°¨ë¶„í•¨", "ì§€í˜œ"], "description": "í•­ìƒ ì¹¨ì°©í•˜ê²Œ ìƒí™©ì„ ë°”ë¼ë³´ëŠ” ë…¼ë¦¬ì  ë¦¬ë”! ê¹Šì€ ì§€í˜œê°€ ëŠê»´ì ¸ìš”.", "emoji": "ğŸ¦‰"},
      {"animal": "í† ë¼", "keywords": ["ë¯¼ê°í•¨", "ë‹¤ì •í•¨", "ì‚¬íšŒì„±"], "description": "ê°ìˆ˜ì„±ì´ í’ë¶€í•˜ê³  ë°°ë ¤ì‹¬ ë„˜ì¹˜ëŠ” ì‚¬íšŒì  ì¡´ì¬ë„¤ìš”.", "emoji": "ğŸ°"},
      {"animal": "ì‚¬ìŠ´", "keywords": ["ì¡°ìš©í•¨", "ê¾¸ì¤€í•¨", "ì˜¨í™”í•¨"], "description": "ì¡°ìš©í•˜ì§€ë§Œ ë‹¤ì •í•˜ê³ , í•œê²°ê°™ì€ ì˜¨í™”í•¨ì´ ë§¤ë ¥ í¬ì¸íŠ¸ì˜ˆìš”.", "emoji": "ğŸ¦Œ"},
      {"animal": "ì—¬ìš°", "keywords": ["ì¬ì¹˜", "ìœ ì—°í•¨", "ì„¼ìŠ¤"], "description": "ì„¼ìŠ¤ ìˆê³  ì ì‘ë ¥ì´ ë›°ì–´ë‚˜ëŠ” ë‹¹ì‹ ! ì¬ì¹˜ê°€ ë„˜ì³ìš”.", "emoji": "ğŸ¦Š"},
      {"animal": "ê³°", "keywords": ["ë¬µì§í•¨", "ì±…ì„ê°", "ìš°ì§í•¨"], "description": "ë¬µë¬µíˆ ìê¸° ê¸¸ì„ ê°€ë©° ì±…ì„ê°ì´ ê°•í•œ íƒ€ì…ì…ë‹ˆë‹¤.", "emoji": "ğŸ»"},
      {"animal": "í­ê·„", "keywords": ["íŒ€ì›Œí¬", "ì¹œê·¼í•¨", "ìœ ë¨¸"], "description": "ëª¨ë‘ì™€ ì˜ ì–´ìš¸ë¦¬ê³ , ì§‘ë‹¨ ìƒí™œì„ ì¦ê¸°ëŠ” ìœ ë¨¸ëŸ¬ìŠ¤í•œ ìŠ¤íƒ€ì¼!", "emoji": "ğŸ§"},
      {"animal": "ì¹˜íƒ€", "keywords": ["ì†ë„", "ì¦‰í¥ì ", "ì ê·¹ì "], "description": "ì¦‰ê°ì ì¸ ì‹¤í–‰ë ¥ê³¼ í™œë ¥, ìƒˆë¡œìš´ ê²ƒì— ë„ì „í•˜ëŠ” ê±¸ ë‘ë ¤ì›Œí•˜ì§€ ì•Šì•„ ë©‹ì ¸ìš”.", "emoji": "ğŸ†"},
      {"animal": "íŒë‹¤", "keywords": ["í‰í™”", "ì˜¨ìˆœí•¨", "ê¸ì •"], "description": "í‰í™”ë¡­ê³  ëŠê¸‹í•˜ë©°, ì£¼ë³€ì„ í¸í•˜ê²Œ ë§Œë“¤ì–´ì£¼ëŠ” ë”°ëœ»í•œ ì‚¬ëŒì…ë‹ˆë‹¤.", "emoji": "ğŸ¼"}
    ]
  };

  const QUESTION_COUNT = 20;
  const MAX_RETRY = 10;
  const MAX_ANIMAL_WEIGHT_RATIO = 0.4;

  const choiceList = [
    { label: "ë§¤ìš° ê·¸ë ‡ë‹¤", value: 5 },
    { label: "ê·¸ë ‡ë‹¤", value: 4 },
    { label: "ë³´í†µ", value: 3 },
    { label: "ì•„ë‹ˆë‹¤", value: 2 },
    { label: "ì „í˜€ ì•„ë‹ˆë‹¤", value: 1 },
  ];

  const container = document.querySelector(".container");
  const $qArea = document.querySelector(".question-area");
  const $choices = document.querySelector(".choices");
  const $result = document.querySelector(".result-area");
  const $progress = document.querySelector(".progress-bar");

  let curIdx = 0;
  let answers = [];
  let selectedQuestions = [];
  const animalList = dataPool.results.map((r) => r.animal);

  let animalScores = {};

  function pickBalancedQuestions() {
    for (let attempt = 0; attempt < MAX_RETRY; attempt++) {
      const shuffledPool = [...dataPool.questions].sort(() => Math.random() - 0.5);
      const candidateQuestions = shuffledPool.slice(0, QUESTION_COUNT);

      // ê° ë™ë¬¼ ì ìˆ˜ í•©ì‚°
      const totalWeights = {};
      animalList.forEach((a) => (totalWeights[a] = 0));

      candidateQuestions.forEach((q) => {
        for (const [animal, w] of Object.entries(q.scores)) {
          totalWeights[animal] += w;
        }
      });
      const totalWeightSum = Object.values(totalWeights).reduce((a,b) => a + b, 0);

      // ê°€ì¥ í° ë™ë¬¼ ê°€ì¤‘ì¹˜ ë¹„ìœ¨ ì²´í¬
      const maxRatio = Math.max(...Object.values(totalWeights)) / totalWeightSum;

      // ë¹„ìœ¨ì´ ë„ˆë¬´ í¬ë©´ ì¬ì‹œë„
      if (maxRatio > MAX_ANIMAL_WEIGHT_RATIO) {
        continue;
      }

      // ì ì ˆí•œ ë°¸ëŸ°ìŠ¤ë©´ ì„ íƒ
      console.log("ì§ˆë¬¸ ì„ íƒ ì„±ê³µ:", totalWeights);
      return candidateQuestions;
    }
    // ì¬ì‹œë„ ëª¨ë‘ ì‹¤íŒ¨ì‹œ ê·¸ëƒ¥ ì• 20ê°œ ì‚¬ìš© (ìµœì•… ë°©ì§€)
    console.warn("ë°¸ëŸ°ìŠ¤ ìœ ì§€ ì‹¤íŒ¨, ê¸°ë³¸ 20ë¬¸í•­ ì„ íƒ");
    return dataPool.questions.slice(0, QUESTION_COUNT);
  }

  // ë¬¸ì œ ì¶œì œ (ë°¸ëŸ°ìŠ¤ ì²´í¬) í›„ ë Œë”ë§ ì‹œì‘
  function startTest() {
    selectedQuestions = pickBalancedQuestions();
    animalScores = {};
    animalList.forEach((a) => {
      animalScores[a] = 0;
    });
    answers = new Array(selectedQuestions.length);
    curIdx = 0;
    $result.classList.add("hide");
    $qArea.classList.remove("hide");
    $choices.classList.remove("hide");
    renderQuestion(curIdx);
  }

  // ë¬¸ì œ ë Œë”
  function renderQuestion(idx) {
    const qObj = selectedQuestions[idx];
    $qArea.innerHTML = `<span>${idx + 1}. ${qObj.text}</span>`;
    $choices.innerHTML = "";
    choiceList.forEach((c) => {
      const btn = document.createElement("button");
      btn.className = "choicebtn";
      btn.type = "button";
      btn.innerText = c.label;
      btn.onclick = () => answer(idx, c.value, btn);
      $choices.appendChild(btn);
    });
    $progress.style.width = ((idx / selectedQuestions.length) * 100) + "%";
    setTimeout(() => {
      $choices.firstElementChild?.focus();
    }, 50);
  }

  function answer(idx, point, btn) {
    [...$choices.children].forEach((b) => (b.disabled = true));
    btn.classList.add("selected");
    answers[idx] = point;
    setTimeout(() => {
      if (curIdx < selectedQuestions.length - 1) {
        curIdx++;
        renderQuestion(curIdx);
      } else {
        showResult();
      }
    }, 350);
  }

  function showResult() {
    animalList.forEach((a) => (animalScores[a] = 0));

    selectedQuestions.forEach((q, i) => {
      const userPoint = answers[i];
      for (const [animal, weight] of Object.entries(q.scores)) {
        animalScores[animal] += userPoint * weight;
      }
    });

    console.log("ìµœì¢… ë™ë¬¼ ì ìˆ˜:", animalScores);

    const sortedScores = Object.entries(animalScores).sort((a, b) => b[1] - a[1]);
    const bestAnimal = sortedScores[0][0];
    const resultObj = dataPool.results.find((r) => r.animal === bestAnimal);

    $qArea.classList.add("hide");
    $choices.classList.add("hide");
    $progress.style.width = "100%";
    $result.classList.remove("hide");
    $result.innerHTML = `
        <div class="emoji" aria-hidden="true">${resultObj.emoji}</div>
        <div class="result-animal">${resultObj.animal}</div>
        <div class="keywords" aria-label="í‚¤ì›Œë“œ">#${resultObj.keywords.join(" #")}</div>
        <div class="result-desc">${resultObj.description}</div>
        <button class="share-btn" type="button" aria-label="ê²°ê³¼ ë³µì‚¬í•˜ê¸°" onclick="copyResult()">ê²°ê³¼ ë³µì‚¬í•˜ê¸°</button>
        <button class="restart-btn" type="button" aria-label="í…ŒìŠ¤íŠ¸ ë‹¤ì‹œí•˜ê¸°" onclick="startTest()">í…ŒìŠ¤íŠ¸ ë‹¤ì‹œí•˜ê¸°</button>
      `;
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function copyResult() {
    const animal = document.querySelector(".result-animal").innerText;
    const desc = document.querySelector(".result-desc").innerText;
    const keys = document.querySelector(".keywords").innerText;
    const text = `[ë™ë¬¼ì‹¬ë¦¬ í…ŒìŠ¤íŠ¸ ê²°ê³¼]\n\n${animal}\n${keys}\n${desc}\n\nğŸ‘‰ ì§ì ‘ í•´ë³´ê¸°: ${location.origin}${location.pathname}`;
    navigator.clipboard.writeText(text).then(() => {
      alert("ê²°ê³¼ê°€ ë³µì‚¬ëì–´ìš”!\nì¹œêµ¬ì—ê²Œ ë¶™ì—¬ë„£ê¸° í•´ë³´ì„¸ìš”.");
    });
  }

  startTest();
</script>
</body>
</html>
