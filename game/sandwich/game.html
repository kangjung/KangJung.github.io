<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê³¼ì¼ìƒŒë“œìœ„ì¹˜ í¬ì¥ëŒ€ì‘ì „</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2007216448786117" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NML6BS1JMB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-NML6BS1JMB');
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    html, body {
      overflow-x: hidden;
      width: 100%;
      box-sizing: border-box;
    }
    body {
      background: repeating-linear-gradient(135deg, #fdf6f0 0px, #fdf6f0 40px, #ffe7f3 40px, #ffe7f3 80px);
      font-family: 'Press Start 2P', 'Pretendard', monospace, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      letter-spacing: 1px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    .title-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 78vh;
      max-width: 480px;
      width: 100vw;
      margin: 0 auto;
      padding: 24px 0;
      text-align: center;
      gap: 24px;
    }
    .title-logo {
      font-size: 2.2rem;
      color: #e95a8b;
      text-shadow: 4px 4px 0 #fff;
      margin-bottom: 16px;
      letter-spacing: 2px;
    }
    .title-sub {
      font-size: 1rem;
      color: #e95a8b;
      text-shadow: 2px 2px 0 #fff;
      margin-bottom: 32px;
    }
    .start-btn, .tutorial-btn {
      border: 3px solid #e95a8b;
      background: #fff3f7;
      color: #e95a8b;
      font-family: 'Press Start 2P', monospace;
      font-size: 0.9rem;
      padding: 12px 24px;
      border-radius: 10px;
      margin: 8px;
      cursor: pointer;
      transition: transform 0.13s, box-shadow 0.13s;
      box-shadow: 4px 4px 0 #e95a8b55;
    }
    .start-btn:hover, .tutorial-btn:hover {
      transform: scale(1.04) rotate(-1deg);
      background: #ffe7f3;
      box-shadow: 0 6px 16px #e95a8b33;
    }
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
    }
    .pixel-art {
      width: 128px;
      height: 128px;
      background: linear-gradient(135deg, #fff8fb 60%, #ffe7f3 100%);
      border-radius: 24px;
      border: 4px solid #e95a8b;
      box-shadow: 0 8px 24px #e95a8b33;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    #gameScreen {
      display: none;
      flex-direction: column;
      align-items: center;
      max-width: 500px;
      width: 100vw;
      min-height: 80vh;
      margin: 0 auto;
      padding: 24px 0;
    }
    #timer {
      font-size: 1.1rem;
      color: #e95a8b;
      margin: 32px 0 18px 0;
      text-shadow: 2px 2px 0 #fff;
      font-weight: bold;
      border: 2px dashed #e95a8b;
      background: #fff8fb;
      padding: 8px 24px;
      border-radius: 12px;
      box-shadow: 0 2px 0 #e95a8b44;
      display: inline-block;
    }
    .box-area {
      width: 98vw;
      max-width: 400px;
      height: 200px;
      margin: 0 auto 28px auto;
      background: #fff;
      border-radius: 20px 20px 32px 32px;
      box-shadow: 0 0 0 6px #e95a8b, 0 8px 24px #e95a8b33;
      position: relative;
      display: flex;
      flex-direction: row-reverse;
      align-items: flex-end;
      justify-content: flex-start;
      border: 4px dotted #e95a8b;
      overflow: visible;
      gap: 0;
      padding: 18px 8px 18px 8px;
      box-sizing: border-box;
    }
    .pixel-ribbon {
      position: absolute;
      width: 280px;
      text-align: center;
      top: 177px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff3f7;
      color: #e95a8b;
      font-size: 0.85rem;
      font-weight: bold;
      padding: 6px 18px;
      border-radius: 8px;
      border: 2px solid #e95a8b;
      box-shadow: 2px 2px 0 #e95a8b66;
      font-family: 'Press Start 2P', monospace;
      z-index: 2;
      letter-spacing: 2px;
    }
    .slot {
      width: 18vw;
      min-width: 56px;
      max-width: 80px;
      height: 100vw;
      max-height: 160px;
      background: #ffe7f3;
      border: 2px dashed #e95a8b;
      border-radius: 10px 10px 18px 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: 0 2px 0 #e95a8b22;
      transition: background 0.25s;
      overflow: hidden;
      box-sizing: border-box;
    }
    .slot .hint-img {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 55px;
      opacity: 0.23;
      z-index: 1;
      pointer-events: none;
      image-rendering: pixelated;
      filter: blur(0.5px);
    }
    .slot.filled .hint-img {
      display: none;
    }
    .slot.filled {
      background: #fff0f6;
      border-style: solid;
      animation: pop 0.25s;
    }
    @keyframes pop {
      0% { transform: scale(0.8);}
      80% { transform: scale(1.1);}
      100% { transform: scale(1);}
    }
    .slot .real-img {
      width: 62px;
      height: 150px;
      object-fit: contain;
      image-rendering: pixelated;
      border-radius: 8px;
      box-shadow: 0 2px 0 #e95a8b22;
      position: relative;
      z-index: 2;
      opacity: 1;
    }
    .slot .emoji {
      position: absolute;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.1rem;
      pointer-events: none;
      opacity: 0.8;
      z-index: 3;
    }
    .sandwich-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin: 0 0 36px 0;
      width: 100vw;
      max-width: 410px;
      box-sizing: border-box;
    }
    .sandwich-btn {
      border: 3px solid #e95a8b;
      background: #fff3f7;
      cursor: pointer; outline: none;
      transform: scale(1);
      transition: transform 0.13s;
      transition: transform 0.13s, box-shadow 0.13s;
      border-radius: 10px;
      box-shadow: 2px 2px 0 #e95a8b44;
      padding: 0 0 7px 0;
      position: relative;
      font-family: 'Press Start 2P', monospace;
      min-width: 90px;
      min-height: 110px;
      display: flex; flex-direction: column; align-items: center;
    }
    .sandwich-btn:active, .sandwich-btn:focus, .sandwich-btn:hover {
      transform: scale(1.06) rotate(-2deg);
      transition: transform 0.13s;
      box-shadow: 0 6px 16px #e95a8b33;
      background: #ffe7f3;
      z-index: 2;
    }
    .sandwich-img {
      width: 64px; height: 120px; object-fit: contain; border-radius: 6px;
      border: 2px solid #e95a8b; background: #fff0f6;
      display: block;
      margin: 10px auto 2px auto;
      transition: box-shadow 0.2s;
      image-rendering: pixelated;
    }
    .sandwich-btn span {
      display: block;
      text-align: center;
      font-size: 0.82rem;
      color: #e95a8b;
      font-weight: 700;
      letter-spacing: 1px;
      text-shadow: 1px 1px 0 #fff;
      margin-bottom: 2px;
      font-family: 'Press Start 2P', monospace;
      word-break: keep-all;
    }
    .best-score {
      background: #fff3f7;
      border: 3px solid #e95a8b;
      border-radius: 12px;
      padding: 6px 20px;
      margin: 12px auto;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      box-shadow: 2px 2px 0 #e95a8b44;
      font-family: 'Press Start 2P', monospace;
      color: #e95a8b;
      font-size: 0.9rem;
      text-shadow: 1px 1px 0 #fff;
    }
    .score-label {
      font-size: 0.8rem;
    }
    .score-value {
      font-size: 1.1rem;
      font-weight: bold;
      background: #fff;
      border-radius: 8px;
      padding: 4px 12px;
      border: 2px solid #e95a8b;
      box-shadow: 1px 1px 0 #e95a8b66;
    }
    /* ì–¸ì–´ ì„ íƒ ë²„íŠ¼ */
    .lang-select {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 6px;
      z-index: 100;
    }
    .lang-btn {
      border: 2px solid #e95a8b;
      background: #fff3f7;
      color: #e95a8b;
      font-family: 'Press Start 2P', monospace;
      font-size: 0.8rem;
      padding: 4px 12px;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .lang-btn.active {
      background: #e95a8b;
      color: #fff;
    }
    /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
    @media (max-width: 500px) {
      .title-screen, #gameScreen {
        max-width: 100vw;
        width: 100vw;
        padding: 0;
      }
      .box-area {
        width: 98vw;
        max-width: 100vw;
        padding: 10px 2vw;
        min-height: 120px;
      }
      .slot {
        width: 18vw;
        min-width: 48px;
        max-width: 22vw;
        margin-left: 2vw;
        height: 100vw;
        max-height: 150px;
      }
      .sandwich-list {
        max-width: 100vw;
        gap: 2vw;
      }
      .sandwich-btn {
        min-width: 22vw;
        max-width: 28vw;
        min-height: 80px;
        padding: 0 0 4px 0;
      }
      .sandwich-img {
        width: 16vw;
        min-width: 36px;
        max-width: 60px;
        height: auto;
      }
      .lang-select {
        top: 6px;
        right: 6px;
      }
      .lang-btn {
        font-size: 0.7rem;
        padding: 2px 8px;
      }
    }
    /* ê´‘ê³  ì˜ì—­ë„ ë„˜ì¹˜ì§€ ì•Šê²Œ */
    .adsbygoogle {
      width: 100vw !important;
      min-width: 0 !important;
      max-width: 100vw !important;
    }
  </style>
</head>
<body>
<!-- ê´‘ê³  -->
<div style="width: 100%;height: 10% ">
  <ins class="adsbygoogle" style="display:inline-block;width:100%;min-width:380px; height:90px" data-ad-client="ca-pub-2007216448786117" data-ad-slot="8678539906" data-auto-ads="false"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>
<!-- ì–¸ì–´ ì„ íƒ ë²„íŠ¼ -->
<div class="lang-select">
  <button class="lang-btn" id="langKo" onclick="setLanguage('ko')">í•œêµ­ì–´</button>
  <button class="lang-btn" id="langEn" onclick="setLanguage('en')">English</button>
</div>
<!-- ì‹œì‘í™”ë©´ -->
<div class="title-screen" id="titleScreen">
  <div class="pixel-art">
    <img src="strawberry_pixel.png" style="width:48px; position:absolute; left:12px; bottom:16px; filter: drop-shadow(2px 2px 0 #fff);" />
    <img src="kiwi_pixel.png" style="width:48px; position:absolute; left:40px; bottom:24px; z-index:2; filter: drop-shadow(2px 2px 0 #fff);" />
    <img src="banana_pixel.png" style="width:48px; position:absolute; left:68px; bottom:16px; filter: drop-shadow(2px 2px 0 #fff);" />
  </div>
  <div class="title-logo" id="titleLogo">ê³¼ì¼ìƒŒë“œìœ„ì¹˜ í¬ì¥ëŒ€ì‘ì „</div>
  <!-- ìµœëŒ€ ìŠ¤ì½”ì–´ í‘œì‹œ -->
  <div class="best-score">
    <span class="score-label" id="bestScoreLabel">ìµœê³  ê¸°ë¡</span>
    <div id="sandwith_score" class="score-value">0</div>
  </div>
  <div class="title-sub" id="titleSub">ì£¼ë¬¸ì„ ë§ì¶° ìƒŒë“œìœ„ì¹˜ë¥¼ í¬ì¥í•˜ì„¸ìš”!</div>
  <div class="btn-group">
    <button class="start-btn" id="startBtn" onclick="startGame()">START</button>
    <button class="tutorial-btn" id="tutorialBtn" onclick="showTutorial()">ê²Œì„ë°©ë²•</button>
  </div>
</div>
<!-- íŠœí† ë¦¬ì–¼ ëª¨ë‹¬ -->
<div id="tutorialModal" style="
  display: none;
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.7); backdrop-filter: blur(2px);
  z-index: 100; overflow: auto;
">
  <div style="
    background: #fff8fb; border: 4px solid #e95a8b;
    border-radius: 24px; box-shadow: 0 8px 32px #e95a8b55;
    width: 90%; max-width: 400px; margin: 40px auto; padding: 24px;
    min-height: 600px;
    max-height: 700px;
    font-family: 'Press Start 2P', monospace; color: #e95a8b;
    text-align: center;
  ">
    <h2 style="margin: 0 0 16px 0; font-size: 1.4rem;" id="tutorialTitle">ê²Œì„ ë°©ë²•</h2>
    <div style="margin: 0 0 12px 0;">
      <p style="font-size: 0.9rem; margin: 16px 0;" id="tutorialDesc1">ì£¼ë¬¸ì— ë§ëŠ” ìƒŒë“œìœ„ì¹˜ë¥¼ ìˆœì„œëŒ€ë¡œ í¬ì¥í•˜ì„¸ìš”!</p>
    </div>
    <div style="background: #fff; border-radius: 12px; padding: 12px; margin: 12px 0;">
      <img src="box_pixel.png" style="width: 100%; height: auto; margin: 0 auto; display: block; image-rendering: pixelated;">
      <p style="font-size: 0.8rem; margin: 8px 0;" id="tutorialDesc2">ìƒìì— ë“¤ì–´ê°ˆ ìƒŒë“œìœ„ì¹˜ê°€ ë³´ì—¬ìš”. ìˆœì„œëŒ€ë¡œ ë§ì¶”ë©´ ì„±ê³µ!</p>
    </div>
    <div style="background: #fff; border-radius: 12px; padding: 12px; margin: 12px 0;">
      <img src="strawberry_pixel.png" style="width: 60px; height: auto; margin: 0 4px; image-rendering: pixelated;">
      <img src="kiwi_pixel.png" style="width: 60px; height: auto; margin: 0 4px; image-rendering: pixelated;">
      <img src="banana_pixel.png" style="width: 60px; height: auto; margin: 0 4px; image-rendering: pixelated;">
      <p style="font-size: 0.8rem; margin: 8px 0;" id="tutorialDesc3">ì•„ë˜ì—ì„œ ìƒŒë“œìœ„ì¹˜ë¥¼ ê³¨ë¼ í¬ì¥í•˜ì„¸ìš”!</p>
    </div>
    <button onclick="hideTutorial()" style="
      background: #e95a8b; color: #fff; border: none;
      padding: 10px 24px; border-radius: 10px; font-size: 0.9rem;
      margin-top: 16px; cursor: pointer; font-family: inherit;
    " id="tutorialCloseBtn">ë‹«ê¸°</button>
  </div>
</div>
<!-- ê²Œì„ í™”ë©´ -->
<div id="gameScreen">
  <div id="timer">TIME: 10</div>
  <div class="box-area" id="boxArea">
    <div class="pixel-ribbon" id="boxLabel">ğŸ± í¬ì¥ìš©ê¸° 1</div>
  </div>
  <div class="sandwich-list" id="sandwichList"></div>
</div>
<!-- ê²Œì„ì˜¤ë²„ ëª¨ë‹¬ -->
<div id="gameOverModal" style="
  display: none;
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.7); backdrop-filter: blur(2px);
  z-index: 100; overflow: auto;
">
  <div style="
    background: #fff8fb; border: 4px solid #e95a8b;
    border-radius: 24px; box-shadow: 0 8px 32px #e95a8b55;
    width: 90%; max-width: 400px; margin: 40px auto; padding: 24px; height: 200px;
    font-family: 'Press Start 2P', monospace; color: #e95a8b;
    text-align: center;
  ">
    <h2 style="margin: 0 0 16px 0; font-size: 1.4rem;" id="gameOverTitle">í¬ì¥ ì™„ë£Œ!</h2>
    <p id="resultText" style="font-size: 0.9rem; margin: 16px 0;">
      <!-- ê²°ê³¼ ë¬¸êµ¬ê°€ ë™ì ìœ¼ë¡œ ë“¤ì–´ê° -->
    </p>
    <button onclick="restartGame()" style="
      background: #e95a8b; color: #fff; border: none;
      padding: 10px 24px; border-radius: 10px; font-size: 0.9rem;
      margin-top: 16px; cursor: pointer; font-family: inherit;
    " id="restartBtn">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
  </div>
</div>
<!-- ê´‘ê³  -->
<div style="width: 100%;height: 10% ">
  <ins class="adsbygoogle" style="display:inline-block;width:100%;min-width:380px; height:90px" data-ad-client="ca-pub-2007216448786117" data-ad-slot="8678539906" data-auto-ads="false"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>
<script>
  // ì–¸ì–´ë³„ í…ìŠ¤íŠ¸ ë°ì´í„°
  const langData = {
    ko: {
      titleLogo: "ê³¼ì¼ìƒŒë“œìœ„ì¹˜ í¬ì¥ëŒ€ì‘ì „",
      bestScoreLabel: "ìµœê³  ê¸°ë¡",
      titleSub: "ì£¼ë¬¸ì„ ë§ì¶° ìƒŒë“œìœ„ì¹˜ë¥¼ í¬ì¥í•˜ì„¸ìš”!",
      startBtn: "ì‹œì‘í•˜ê¸°",
      tutorialBtn: "ê²Œì„ë°©ë²•",
      tutorialTitle: "ê²Œì„ ë°©ë²•",
      tutorialDesc1: "ì£¼ë¬¸ì— ë§ëŠ” ìƒŒë“œìœ„ì¹˜ë¥¼ ìˆœì„œëŒ€ë¡œ í¬ì¥í•˜ì„¸ìš”!",
      tutorialDesc2: "ìƒìì— ë“¤ì–´ê°ˆ ìƒŒë“œìœ„ì¹˜ê°€ ë³´ì—¬ìš”. ìˆœì„œëŒ€ë¡œ ë§ì¶”ë©´ ì„±ê³µ!",
      tutorialDesc3: "ì•„ë˜ì—ì„œ ìƒŒë“œìœ„ì¹˜ë¥¼ ê³¨ë¼ í¬ì¥í•˜ì„¸ìš”!",
      tutorialCloseBtn: "ë‹«ê¸°",
      boxLabel: "ğŸ± í¬ì¥ìš©ê¸° 1",
      gameOverTitle: "í¬ì¥ ì™„ë£Œ!",
      resultText: "ì´ <strong>${round-1}</strong>ê°œì˜ ë°•ìŠ¤ë¥¼ í¬ì¥í–ˆìŠµë‹ˆë‹¤!",
      restartBtn: "ë‹¤ì‹œ ì‹œì‘í•˜ê¸°"
    },
    en: {
      titleLogo: "Fruit Sandwich Packing",
      bestScoreLabel: "Best Score",
      titleSub: "Pack sandwiches according to the order!",
      startBtn: "START",
      tutorialBtn: "How to Play",
      tutorialTitle: "How to Play",
      tutorialDesc1: "Pack sandwiches in the correct order!",
      tutorialDesc2: "The sandwiches to pack are shown in the box. Match the order to win!",
      tutorialDesc3: "Choose sandwiches from below and pack them!",
      tutorialCloseBtn: "Close",
      boxLabel: "ğŸ± Packing Box 1",
      gameOverTitle: "Packing Complete!",
      resultText: "You packed <strong>${round-1}</strong> boxes!",
      restartBtn: "Play Again"
    }
  };

  // ìƒŒë“œìœ„ì¹˜ ì´ë¦„ë„ ì–¸ì–´ë³„ë¡œ ê´€ë¦¬ (ì„ íƒì‚¬í•­)
  const sandwichNames = {
    ko: ['ë”¸ê¸°ìƒŒë“œ', 'í‚¤ìœ„ìƒŒë“œ', 'ë°”ë‚˜ë‚˜ìƒŒë“œ', 'í¬ë„ìƒŒë“œ', 'ì˜¤ë Œì§€ìƒŒë“œ', 'ë² ë¦¬ìƒŒë“œ', 'ë§ê³ ìƒŒë“œ'],
    en: ['Strawberry', 'Kiwi', 'Banana', 'Grape', 'Orange', 'Berry', 'Mango']
  };

  const sandwiches = [
    { img: 'strawberry_pixel.png' },
    { img: 'kiwi_pixel.png' },
    { img: 'banana_pixel.png' },
    { img: 'grape_pixel.png' },
    { img: 'orange_pixel.png' },
    { img: 'berry_pixel.png' },
    { img: 'mango_pixel.png' }
  ];

  let round = 1;
  let time = 10;
  let timerId = null;
  let boxSandwiches = [];
  let filled = 0;
  let currentLang = localStorage.getItem('gameLang') || 'ko';

  // ë¸Œë¼ìš°ì € ì–¸ì–´ ê°ì§€ (ì„ íƒì‚¬í•­)
  function detectBrowserLanguage() {
    const browserLang = navigator.language || navigator.userLanguage;
    const langCode = browserLang.substring(0, 2);
    return langCode === 'ko' ? 'ko' : 'en';
  }
  // currentLang = detectBrowserLanguage(); // í•„ìš”ì‹œ ì£¼ì„ í•´ì œ

  // ì–¸ì–´ ì„¤ì • í•¨ìˆ˜
  function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('gameLang', lang);
    updateLanguage();
  }

  // í…ìŠ¤íŠ¸ ê°±ì‹  í•¨ìˆ˜
  function updateLanguage() {
    // ì–¸ì–´ ì„ íƒ ë²„íŠ¼ í™œì„±í™”
    document.getElementById('langKo').classList.toggle('active', currentLang === 'ko');
    document.getElementById('langEn').classList.toggle('active', currentLang === 'en');

    // ê° í…ìŠ¤íŠ¸ ê°±ì‹ 
    document.getElementById('titleLogo').textContent = langData[currentLang].titleLogo;
    document.getElementById('bestScoreLabel').textContent = langData[currentLang].bestScoreLabel;
    document.getElementById('titleSub').textContent = langData[currentLang].titleSub;
    document.getElementById('startBtn').textContent = langData[currentLang].startBtn;
    document.getElementById('tutorialBtn').textContent = langData[currentLang].tutorialBtn;
    document.getElementById('tutorialTitle').textContent = langData[currentLang].tutorialTitle;
    document.getElementById('tutorialDesc1').textContent = langData[currentLang].tutorialDesc1;
    document.getElementById('tutorialDesc2').textContent = langData[currentLang].tutorialDesc2;
    document.getElementById('tutorialDesc3').textContent = langData[currentLang].tutorialDesc3;
    document.getElementById('tutorialCloseBtn').textContent = langData[currentLang].tutorialCloseBtn;
    document.getElementById('boxLabel').textContent = langData[currentLang].boxLabel.replace('1', round);
    document.getElementById('gameOverTitle').textContent = langData[currentLang].gameOverTitle;
    document.getElementById('restartBtn').textContent = langData[currentLang].restartBtn;

    // ìƒŒë“œìœ„ì¹˜ ì´ë¦„ë„ ë³€ê²½ (ì„ íƒì‚¬í•­)
    if (document.getElementById('sandwichList').children.length > 0) {
      setSandwichList();
    }
  }

  // ìƒŒë“œìœ„ì¹˜ ë¦¬ìŠ¤íŠ¸ ê°±ì‹  (ì´ë¦„ë§Œ ë³€ê²½)
  function setSandwichList() {
    const list = document.getElementById('sandwichList');
    const available = getAvailableSandwiches();
    available.forEach((s, idx) => {
      const btn = list.children[idx];
      if (btn) {
        btn.querySelector('span').textContent = sandwichNames[currentLang][idx];
      }
    });
  }

  /* --- ì•„ë˜ëŠ” ê¸°ì¡´ ê²Œì„ ë¡œì§ (ë³€ê²½ ì—†ìŒ) --- */
  function startGame() {
    document.getElementById('titleScreen').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'flex';
    reset();
  }
  function getAvailableSandwiches() {
    const baseCount = 3;
    const addCount = Math.floor((round - 1) / 5);
    return sandwiches.slice(0, baseCount + addCount);
  }
  function getBoxSandwichCount() {
    const available = getAvailableSandwiches();
    const addCountMax = Math.floor((round - 1) / 5);
    const addCountMin = Math.floor((round - 1) / 10);
    let min = Math.max(1, 1 + addCountMin);
    let max = Math.min(5, 2 + addCountMax);
    if (min > max) min = max;
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }
  function getTimeLimit() {
    return Math.max(3, 10 - Math.floor((round - 1) / 5));
  }
  function nextBox() {
    filled = 0;
    const available = getAvailableSandwiches();
    const count = getBoxSandwichCount();
    boxSandwiches = shuffle([...available]).slice(0, count);
    setSandwichList();
    time = getTimeLimit();
    updateTimer();
    if (timerId) clearInterval(timerId);
    startTimer();
    setBoxArea();
  }
  function setBoxArea() {
    const box = document.getElementById('boxArea');
    box.querySelectorAll('.slot').forEach(e => e.remove());
    document.getElementById('boxLabel').textContent = langData[currentLang].boxLabel.replace('1', round);
    for (let i = 0; i < boxSandwiches.length; ++i) {
      const slot = document.createElement('div');
      slot.className = 'slot' + (i < filled ? ' filled' : '');
      const hintImg = document.createElement('img');
      hintImg.className = 'hint-img';
      hintImg.src = boxSandwiches[i].img;
      hintImg.alt = sandwichNames[currentLang][i];
      slot.appendChild(hintImg);
      if (i < filled) {
        const realImg = document.createElement('img');
        realImg.className = 'real-img';
        realImg.src = boxSandwiches[i].img;
        realImg.alt = sandwichNames[currentLang][i];
        slot.appendChild(realImg);
      }
      box.insertBefore(slot, box.querySelector('.pixel-ribbon').nextSibling);
    }
  }

  function setSandwichList() {
    const list = document.getElementById('sandwichList');
    list.innerHTML = '';
    const available = getAvailableSandwiches();
    available.forEach((s, idx) => {
      const btn = document.createElement('button');
      btn.className = 'sandwich-btn';
      btn.onmousedown = () => check(idx);
      // í˜„ì¬ ì–¸ì–´ì— ë§ëŠ” ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
      const name = sandwichNames[currentLang][idx];
      btn.innerHTML = `<img class="sandwich-img" src="${s.img}" alt="${name}"><span>${name}</span>`;
      list.appendChild(btn);
    });
  }


  function check(idx) {
    const available = getAvailableSandwiches();
    if (available[idx].name === boxSandwiches[filled].name) {
      filled++;
      setBoxArea();
      if (filled >= boxSandwiches.length) {
        setTimeout(() => {
          round++;
          nextBox();
        }, 500);
      }
    } else {
      time -= 2; // ì‹¤ìˆ˜ ì‹œ ì‹œê°„ ê°ì 
      updateTimer();
    }
  }

  function updateTimer() {
    document.getElementById('timer').textContent = `TIME: ${time}`;
    const highScore = localStorage.getItem('sandwith_score') || 0;
    if (time <= 0) {
      clearInterval(timerId);
      document.getElementById('gameScreen').style.display = 'none';
      if (round - 1 > highScore) {
        localStorage.setItem('sandwith_score', round - 1);
      }
      const resultText = document.getElementById('resultText');
      resultText.innerHTML = langData[currentLang].resultText.replace('${round-1}', round - 1);
      document.getElementById('gameOverModal').style.display = 'flex';
    }
  }
  function startTimer() {
    timerId = setInterval(() => {
      time--;
      updateTimer();
      if (time <= 0) clearInterval(timerId);
    }, 1000);
  }
  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }
  function reset() {
    round = 1;
    time = getTimeLimit();
    nextBox();
    updateTimer();
    if (timerId) clearInterval(timerId);
    startTimer();
    setSandwichList();
  }
  function showTutorial() {
    document.getElementById('tutorialModal').style.display = 'flex';
  }
  function hideTutorial() {
    document.getElementById('tutorialModal').style.display = 'none';
  }
  function restartGame() {
    displayHighScore();
    document.getElementById('gameOverModal').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'none';
    document.getElementById('titleScreen').style.display = 'flex';
  }
  function displayHighScore() {
    const highScore = localStorage.getItem('sandwith_score') || 0;
    document.getElementById('sandwith_score').textContent = highScore;
  }
  document.getElementById('gameScreen').style.display = 'none';
  document.addEventListener('DOMContentLoaded', function() {
    displayHighScore();
    // ì´ˆê¸° ì–¸ì–´ ì„¤ì •
    setLanguage(currentLang);
  });
</script>
</body>
</html>
